{% extends "base.html" %}


{% block script %}
<script type="text/javascript"language="javascript">
  async function caddFunction(event) {
    event.preventDefault();  // Предотвращаем стандартное действие форм
    
    // Получаем форму и собираем данные из неё
    const form = document.getElementById('addclient-form');
    const formData = new FormData(form);
    const data = Object.fromEntries(formData.entries());

  
    try {
        const response = await fetch('/clientadd', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
        });

        // Проверяем успешность ответа
        if (!response.ok) {
            // Получаем данные об ошибке
            const errorData = await response.json();
            displayErrors(errorData);  // Отображаем ошибки
            return;  // Прерываем выполнение функции
        }

        const result = await response.json();

        if (result.message) {  // Проверяем наличие сообщения о успешной регистрации
            window.location.href = '/new';  // Перенаправляем пользователя на страницу логина
        } else {
            alert(result.message || 'Неизвестная ошибка');
        }
    } catch (error) {
        console.error('Ошибка:', error);
        alert('Произошла ошибка при добавлении клиента. Пожалуйста, попробуйте снова.');
    }
}

</script>

<script type="text/javascript"language="javascript">
  async function ntradeaddFunction(event) {
    event.preventDefault();  // Предотвращаем стандартное действие форм
    
    // Получаем форму и собираем данные из неё
    const form = document.getElementById('addclient-form');
    const formData = new FormData(form);
    const data = Object.fromEntries(formData.entries());

  
    try {
        const response = await fetch('/tradeadd', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
        });

        // Проверяем успешность ответа
        if (!response.ok) {
            // Получаем данные об ошибке
            const errorData = await response.json();
            displayErrors(errorData);  // Отображаем ошибки
            return;  // Прерываем выполнение функции
        }

        const result = await response.json();

        if (result.message) {  // Проверяем наличие сообщения о успешной регистрации
            window.location.href = '/new';  // Перенаправляем пользователя на страницу логина
            alert(result.message || 'Успешно!')
        } else {
            alert(result.message || 'Неизвестная ошибка');
        }
    } catch (error) {
        console.error('Ошибка:', error);
        alert('Произошла ошибка при добавлении продажи. Пожалуйста, попробуйте снова.');
    }
}

</script>
{% endblock %}

{% block content %}
<div class="container">
  <div class="content">
    <h1>Добавление Клиента</h1>
      <label>Добавить нового клиента</label>
    <div class="nice-form-group">
      <form id="addclient-form">
      <div class="nice-form-group">
        <label>Номер клиента</label>
        <input type="tel" placeholder="Номер в формате +71234567890" name="phone_number"/>
      </div>
      <div class="nice-form-group">
        <label>ФИО Клиента</label>
        <input type="text" placeholder="фио" name="names"/>
      </div>
      <div class="nice-form-group">
        <label>Комментарий</label>
        <input type="text" placeholder="комментарий" name="comment"/>
      </div>
      <button type="submit" id="reg-button" class="submit" onclick="caddFunction(event)">Добавить клиента</button>
    </form>
    </div>
  
    </div>
  <div class="flap"></div>
</div>
<div class="container">
  <div class="content">
    <h1>Продажа новой АКБ (или доп. товар)</h1>
    <legend>Магазин</legend>
  <form id="addntrade-form">
  <div class="nice-form-group">
    <input type="radio" name="account" id="авторемонтная" />
    <label for="Авторемонтная">Авторемонтная</label>
    <div class="nice-form-group">
      <input type="radio" name="account" id="березка" />
      <label for="березка">березка</label>
    </div>
    <div class="nice-form-group">
      <input type="radio" name="account" id="юркина" />
      <label for="юркина">юркина</label>
    </div>
    <div class="nice-form-group">
      <input type="radio" name="account" id="Просторная" />
      <label for="Просторная">Просторная</label>
    </div>
    <div class="nice-form-group">
    <input type="radio" name="account" id="пролетарская" />
    <label for="пролетарская">пролетарская</label>
    </div>
  </div>
  <div class="nice-form-group">
    <label>Номер клиента</label>
    <input type="text" placeholder="номер" value="" name="client_number"/>
  </div>
  <div class="nice-form-group">
    <label>АКБ (Название, емкость, полярность)</label>
    <input type="text" placeholder="акб" value="" name="akb"/>
  </div>
  <div class="nice-form-group">
    <label>Цена АКБ</label>
    <input type="text" placeholder="цена" value="" name="akb_price"/>
  </div>
  <div class="nice-form-group">
    <label>Старый АКБ</label>
    <input type="text" placeholder="емкость (по-умолчанию - нет)" value="" name="scrap_akb"/>
  </div>
  <div class="nice-form-group">
    <label>Цена старого</label>
    <input type="text" placeholder="цена (по-умолчанию - 0)" value="" name="scrap_price"/>
  </div>
  <div class="nice-form-group">
    <label>Скидка (сюда не пишется за старый)</label>
    <input type="text" placeholder="скидка" value="" name="action_sum"/>
  </div>
  <div class="nice-form-group">
    <label>Сумма прибыли</label>
    <input type="text" placeholder="итого" value="" name="sum"/>
  </div>
  <div class="nice-form-group">
    <label>Способ оплаты</label>
    <input type="text" placeholder="способ" value="" name="method"/>
  </div>
  <div class="nice-form-group">
    <label>Комментарий (необязательно)</label>
    <input type="text" placeholder="комментарий" value="" name="comment"/>
  </div>
  <div class="nice-form-group">
    <label>Оплата по счету</label>
    <input type="text" placeholder="по умолчанию - нет" value="" name="payment_invoice"/>
  </div>
  <div class="nice-form-group">
    <label>Данные счета</label>
    <input type="text" placeholder="по умолчанию - нет" value="" name="invoice_data"/>
  </div>
  <button type="submit" id="reg-button" class="submit" onclick="ntradeaddFunction(event)">Добавить продажу</button>
  </div>
</form>
  </div>
</div>
<div class="container">
  <div class="content">
    <h1>Добавление Клиента</h1>
    <h3>I love designing websites and keep things as simple as possible. My goals is to focus on minimalism and conveying the message that you want to send</h3>
  </div>
  <div class="flap"></div>
</div>
<div class="container">
  <div class="content">
    <h1>Добавление Клиента</h1>
    <h3>I love designing websites and keep things as simple as possible. My goals is to focus on minimalism and conveying the message that you want to send</h3>
  </div>
  <div class="flap"></div>
</div>

{% endblock %}